# Анализ кадастровых участков

Система анализа кадастровых участков с использованием спутниковых снимков и машинного обучения.

## Структура проекта

```
├── app.py                                   # Основное Streamlit приложение
├── config.py                                # Конфигурация и валидация
├── image_downloader.py                      # Класс для загрузки спутниковых изображений
├── polygon_processor.py                     # Класс для обработки полигонов
├── model_predictor.py                       # Класс для предсказания масок
├── cadastral_processor.py                   # Главный класс обработки кадастров
├── requirements.txt                         # Зависимости проекта
├── .env                                     # Переменные окружения
└── model/
    └── unet_resnet34_plot_segmentation.pth  # Обученная модель
    └── train_model_unet.py                  # Обучение модели
```

## Установка и настройка

### 1. Клонирование репозитория

```bash
git clone https://github.com/nikifolesya/cadastral-analyzer.git
cd cadastral-analyzer
```

### 2. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 3. Настройка переменных окружения

Создайте файл `.env` в корневой директории проекта:

```env
TOMTOM_API_KEY=your_tomtom_api_key_here
```

### 4. Размещение модели

Поместите файл обученной модели `unet_resnet34_plot_segmentation.pth` в папку `model/`.

## Запуск приложения

```bash
streamlit run app.py
```

Приложение откроется в браузере по адресу `http://localhost:8501`.

## Использование

1. **Ввод кадастрового номера**: Введите номер в формате `XX:XX:XXXXXX:XXXX`
2. **Настройка отображения**: Выберите какие элементы показывать (маска, контур, полигон)
3. **Анализ**: Нажмите кнопку "Анализировать участок"
4. **Просмотр результатов**: Изучите результаты анализа и метрики точности
5. **Скачивание**: При необходимости скачайте результат

## Особенности

### Цветовая схема результатов
- **Красный**: Маска сегментации (предсказание модели)
- **Зеленый**: Контур участка (отрисованный по маске)
- **Синий**: Кадастровый полигон (официальные границы по данным из ЕГРН)

### Метрики качества
- **IoU (Intersection over Union)**: Мера совпадения областей
- **Precision (Точность)**: Доля правильно предсказанных пикселей
- **Recall (Полнота)**: Доля найденных пикселей участка

## Архитектура

### Классы и их назначение

1. **SatelliteImageDownloader**: Загрузка спутниковых изображений через TomTom API
2. **PolygonProcessor**: Обработка и отрисовка полигонов на изображениях
3. **ModelPredictor**: Предсказание масок сегментации с помощью U-Net
4. **CadastralProcessor**: Главный класс-оркестратор для полного цикла обработки

### Поток данных

1. Валидация кадастрового номера
2. Получение координат участка через rosreestr2coord
3. Загрузка спутникового изображения через TomTom API
4. Предсказание маски сегментации
5. Отрисовка результатов и вычисление метрик
6. Отображение в Streamlit интерфейсе

## API и зависимости

- **TomTom Maps API**: Для загрузки спутниковых снимков
- **rosreestr2coord**: Для получения координат кадастровых участков
- **PyTorch + segmentation_models_pytorch**: Для работы с моделью сегментации
- **Streamlit**: Веб-интерфейс
- **OpenCV, PIL**: Обработка изображений
- **Shapely**: Геометрические операции

## Требования к системе

- Python 3.8+
- CUDA-совместимая видеокарта (опционально, для ускорения)
- Интернет-соединение для загрузки спутниковых снимков
- Минимум 4 GB RAM

## Возможные проблемы и решения

### Ошибка загрузки модели
Убедитесь, что файл модели находится в правильном месте: `model/unet_resnet34_plot_segmentation.pth`

### Ошибка API TomTom
Проверьте правильность API-ключа в файле `.env`

### Проблемы с кадастровыми номерами
Убедитесь, что номер соответствует формату и существует в базе Росреестра